' Gambas class file

Public arFile As New String[]
Public bingotmp As Bingo

Private obs As Observer
Private contador As Integer

Public Sub Form_Open()
  
  Inc Application.busy
  Wait 0.01
  Me.Center
  cargarlistados()
  Dec Application.busy
  Me.Show()
  
End

Public Sub cargarlistados()
  
  Dim p As PictureBox
  Dim nombrefichero As String
  Dim arfile2 As String[]
  'borra todos los archivos que empiecen por carton*
  arfile2 = Dir(User.home & "/" & "bingoedu/" & bingotmp.NombreFichero, "carton*", gb.file)
  arfile.Clear()
  
  For Each nombrefichero In arfile2
    If File.Ext(nombrefichero) = "png" Then 
      arfile.add(nombrefichero)
    Endif
  Next
  
  For Each nombrefichero In arfile
    p = New PictureBox(ScrollView1) 
    p.w = 100
    p.h = 70
    p.Picture = Picture.Load(User.home & "/" & "bingoedu/" & bingotmp.NombreFichero & "/" & nombrefichero)
    p.Stretch = True
    p.tag = User.home & "/" & "bingoedu/" & bingotmp.NombreFichero & "/" & nombrefichero
    obs = New Observer(p) As "observador"
    
  Next
  
  mostrar(0)
  
End

Public Sub mostrar(n As Integer)
  
  If n > -1 And (n < arfile.count) Then 
    PictureBoxVisor.Picture = Picture.Load(User.home & "/" & "bingoedu/" & bingotmp.NombreFichero & "/" & arfile[n])
    LabelNumero.text = Str$(n + 1)
  Else
    If n >= arfile.count Then
      contador = arfile.count - 1
    Else 
      contador = 0
    Endif
  Endif
  
End

Public Sub observador_MouseDown()
  
  PictureBoxVisor.Picture = Picture.Load(Last.tag)
  PictureBoxVisor.tag = Last.tag
  
End

Public Sub ButtonSiguiente_Click()
  
  contador += 1
  mostrar(contador)
  
End

Public Sub ButtonAnterior_Click()
  
  contador -= 1
  mostrar(contador)
  
End

Public Sub PictureBoxVisor_DblClick()
  
End

Public Sub ButtonEditor_Click()
  
  Shell "inkscape " & Replace(PictureBoxVisor.tag, ".png", ".svg")
  
End

Public Sub ButtonSalir_Click()
  
  Me.Close()
  
End
